{#
/**
 * @file
 * Carousel component - Carrusel de imágenes/contenido
 */
#}

{% set carousel_slides = slides|default([]) %}
{% set carousel_autoplay = autoplay|default(true) %}
{% set carousel_speed = autoplay_speed|default(5000) %}
{% set carousel_arrows = show_arrows|default(true) %}
{% set carousel_dots = show_dots|default(true) %}
{% set carousel_loop = loop|default(true) %}
{% set carousel_effect = effect|default('slide') %}
{% set carousel_ratio = aspect_ratio|default('16/9') %}
{% set carousel_id = custom_id|default('carousel-' ~ random()) %}

{% set carousel =
  html_cva(
    base: ['relative w-full overflow-hidden'],
    variants: {
      aspectRatio: {
        auto: '',
        '16/9': 'aspect-video',
        '4/3': 'aspect-[4/3]',
        '1/1': 'aspect-square',
        '21/9': 'aspect-[21/9]'
      }
    }
  )
%}

{% set additional_classes = custom_class|default('') %}
{% if additional_classes is iterable %}
  {% set additional_classes = additional_classes|join(' ') %}
{% endif %}

{% set carousel_classes = carousel.apply({ aspectRatio: carousel_ratio }, additional_classes) %}

<div
  class="cb-carousel {{ carousel_classes }}"
  id="{{ carousel_id }}"
  data-cb-carousel
  data-autoplay="{{ carousel_autoplay ? 'true' : 'false' }}"
  data-speed="{{ carousel_speed }}"
  data-loop="{{ carousel_loop ? 'true' : 'false' }}"
  data-effect="{{ carousel_effect }}"
  role="region"
  aria-roledescription="carrusel"
  aria-label="Carrusel de imágenes"
>
  {# Slides container #}
  <div class="cb-carousel-track flex transition-transform duration-500 ease-out h-full" data-carousel-track>
    {% for slide in carousel_slides %}
      <div
        class="cb-carousel-slide flex-shrink-0 w-full h-full relative"
        role="group"
        aria-roledescription="slide"
        aria-label="Slide {{ loop.index }} de {{ carousel_slides|length }}"
        data-slide="{{ loop.index0 }}"
      >
        {% if slide.link %}
          <a href="{{ slide.link }}" class="block w-full h-full">
        {% endif %}

        {% if slide.image and slide.image.src %}
          {% include 'canvas:image' ignore missing with {
            src: slide.image.src,
            alt: slide.image.alt|default(''),
            class: 'object-cover w-full h-full',
            width: slide.image.width|default(800),
            height: slide.image.height|default(400)
          } only %}
        {% endif %}

        {% if slide.title or slide.description %}
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6 text-white">
            {% if slide.title %}
              <h3 class="text-xl md:text-2xl font-bold mb-2">{{ slide.title }}</h3>
            {% endif %}
            {% if slide.description %}
              <p class="text-sm md:text-base opacity-90">{{ slide.description }}</p>
            {% endif %}
          </div>
        {% endif %}

        {% if slide.link %}
          </a>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {# Navigation arrows #}
  {% if carousel_arrows and carousel_slides|length > 1 %}
    <button
      type="button"
      class="cb-carousel-prev absolute left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 hover:bg-white shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary"
      aria-label="Slide anterior"
      data-carousel-prev
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <button
      type="button"
      class="cb-carousel-next absolute right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 hover:bg-white shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary"
      aria-label="Siguiente slide"
      data-carousel-next
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  {% endif %}

  {# Dots navigation #}
  {% if carousel_dots and carousel_slides|length > 1 %}
    <div class="cb-carousel-dots absolute bottom-4 left-1/2 -translate-x-1/2 z-10 flex gap-2" role="tablist" aria-label="Seleccionar slide">
      {% for slide in carousel_slides %}
        <button
          type="button"
          class="w-3 h-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 {{ loop.index0 == 0 ? 'bg-white' : 'bg-white/50 hover:bg-white/75' }}"
          role="tab"
          aria-selected="{{ loop.index0 == 0 ? 'true' : 'false' }}"
          aria-label="Ir al slide {{ loop.index }}"
          data-carousel-dot="{{ loop.index0 }}"
        ></button>
      {% endfor %}
    </div>
  {% endif %}
</div>
