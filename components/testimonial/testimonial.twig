{#
/**
 * @file
 * Testimonial component - Testimonio
 */
#}


{% set custom_class = css_class|default('') %}
{% set custom_id = html_id|default('') %}
{% set test_quote = quote|default('') %}
{% set test_author = author_name|default('') %}
{% set test_title = author_title|default('') %}
{% set test_company = author_company|default('') %}
{% set test_rating = rating|default(0) %}
{% set test_layout = layout|default('card') %}
{% set test_alignment = alignment|default('center') %}
{% set test_bg = background|default('white') %}
{% set test_shadow = shadow|default('md') %}

{% set testimonial_cva =
  html_cva(
    base: ['cats-testimonial p-6 rounded-xl'],
    variants: {
      layout: {
        card: '',
        minimal: 'bg-transparent shadow-none',
        quote: 'relative'
      },
      alignment: {
        left: 'text-left',
        center: 'text-center'
      },
      background: {
        white: 'bg-white',
        muted: 'bg-gray-50',
        primary: 'cats-bg-primary text-white',
        dark: 'bg-slate-900 text-white'
      },
      shadow: {
        none: '',
        sm: 'shadow-sm',
        md: 'shadow-md',
        lg: 'shadow-lg'
      }
    }
  )
%}

{% set testimonial_classes =
  testimonial_cva.apply({
    layout: test_layout,
    alignment: test_alignment,
    background: test_layout == 'minimal' ? 'white' : test_bg,
    shadow: test_layout == 'minimal' ? 'none' : test_shadow
  })
%}

{% set text_color = test_bg in ['primary', 'dark'] ? 'text-white' : 'text-gray-600' %}
{% set name_color = test_bg in ['primary', 'dark'] ? 'text-white' : 'cats-text-foreground' %}

<div class="{{ testimonial_classes }} {{ custom_class }}"{% if custom_id %} id="{{ custom_id }}"{% endif %}>
  {# Quote icon for quote layout #}
  {% if test_layout == 'quote' %}
    <svg class="w-12 h-12 {{ test_bg in ['primary', 'dark'] ? 'text-white/20' : 'cats-text-primary/20' }} {{ test_alignment == 'center' ? 'mx-auto' : '' }} mb-4" fill="currentColor" viewBox="0 0 24 24">
      <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
    </svg>
  {% endif %}

  {# Rating stars #}
  {% if test_rating > 0 %}
    <div class="flex gap-1 mb-4 {{ test_alignment == 'center' ? 'justify-center' : '' }}">
      {% for i in 1..5 %}
        <svg class="w-5 h-5 {{ i <= test_rating ? 'text-yellow-400' : 'text-gray-300' }}" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
      {% endfor %}
    </div>
  {% endif %}

  {# Quote text #}
  {% if test_quote %}
    <blockquote class="text-lg {{ text_color }} mb-6">
      "{{ test_quote }}"
    </blockquote>
  {% endif %}

  {# Author #}
  <div class="flex items-center gap-4 {{ test_alignment == 'center' ? 'justify-center' : '' }}">
    {# Author image slot #}
    {% set author_img %}
      {% block author_image %}
      {% endblock %}
    {% endset %}

    {% if author_img|trim is not empty %}
      <div class="w-12 h-12 rounded-full overflow-hidden shrink-0">
        {{ author_img }}
      </div>
    {% endif %}

    <div class="{{ test_alignment == 'center' and author_img|trim is empty ? '' : 'text-left' }}">
      {% if test_author %}
        <div class="font-semibold {{ name_color }}">{{ test_author }}</div>
      {% endif %}
      {% if test_title or test_company %}
        <div class="text-sm {{ text_color }}">
          {{ test_title }}{% if test_title and test_company %}, {% endif %}{{ test_company }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
